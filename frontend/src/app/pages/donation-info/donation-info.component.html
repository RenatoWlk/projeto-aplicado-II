<div class="dashboard-container">
  <!------------------------------------->
  <!-----------SCHEDULE LIST------------->
  <!------------------------------------->
  <section class="app-card card-overflow">
    <div class="app-card-header">
      <i class="fa fa-list app-card-icon"></i>
      <h2 class="app-card-title">Lista de Agendamentos</h2>
    </div>

    <div class="app-card-header">
      <mat-form-field appearance="outline" class="custom-form-field full-width"> 
        <mat-label>Data disponível: </mat-label>
        <input matInput
          [matDatepicker]="datepicker"
          [matDatepickerFilter]="datesWithDonations"
          [(ngModel)]="selectedDate"
          (dateChange)="onDateChange($event)"
        >
        <mat-datepicker-toggle matIconSuffix [for]="datepicker"></mat-datepicker-toggle>
        <mat-datepicker #datepicker [calendarHeaderComponent]="customHeader"></mat-datepicker>
      </mat-form-field>
    </div>

    <app-preloader *ngIf="loadingDonations" type="spinner" [visible]="true"></app-preloader>

    <div class="tab-content" *ngIf="!loadingDonations">
      <div class="table-actions">
        <button class="sort-btn app-button" (click)="sortByHour()">
          <i class="fas fa-clock"></i> Ordenar por horário
        </button>

        <button class="sort-btn app-button" (click)="sortByStatus()">
          <i class="fas fa-flag"></i> Ordenar por status
        </button>
      </div>

      <div class="table-wrapper">
        <div class="table-scroll">
          <table class="donations-table" *ngIf="todayDonations.length > 0; else noDonations" role="table" aria-label="Lista de agendamentos">
            <thead>
              <tr>
                <th class="col-index">#</th>
                <th class="col-name">Nome</th>
                <th class="col-hour">Horário</th>
                <th class="col-status">Status</th>
                <th class="col-actions">Ações</th>
              </tr>
            </thead>

            <tbody>
              <tr *ngFor="let donation of todayDonations; let i = index" role="row">
                <td class="col-index" data-label="#" aria-label="Posição">{{ i + 1 }}</td>

                <td class="col-name" data-label="Nome" aria-label="Nome do doador">
                  {{ donation.userName }}
                </td>

                <td class="col-hour" data-label="Horário" aria-label="Horário">
                  <i class="fas fa-clock hour-icon" aria-hidden="true"></i>
                  {{ donation.hour }}
                </td>

                <td class="col-status" data-label="Status" aria-label="Status">
                  <span class="status-pill" [ngClass]="getStatusClass(donation.status)">
                    {{ getStatusLabel(donation.status) }}
                  </span>
                </td>

                <td class="col-actions" data-label="Ações" aria-label="Ações">
                  <button 
                    *ngIf="canConfirm(donation.status)"
                    class="btn-action btn-confirm"
                    (click)="confirmDonation(donation.id)"
                    title="Confirmar doação">
                    <i class="fas fa-check" aria-hidden="true"></i>
                    <span class="btn-text">Confirmar</span>
                  </button>

                  <button 
                    *ngIf="canComplete(donation.status)"
                    class="btn-action btn-complete"
                    (click)="completeDonation(donation.id)"
                    title="Marcar como completada">
                    <i class="fas fa-check-double" aria-hidden="true"></i>
                    <span class="btn-text">Completar</span>
                  </button>

                  <button 
                    *ngIf="canCancel(donation.status)"
                    class="btn-action btn-cancel"
                    (click)="cancelDonation(donation.id, donation.userId)"
                    title="Cancelar doação">
                    <i class="fas fa-times" aria-hidden="true"></i>
                    <span class="btn-text">Cancelar</span>
                  </button>

                  <span *ngIf="!canConfirm(donation.status) && !canComplete(donation.status) && !canCancel(donation.status)"
                        class="no-actions" aria-hidden="true">
                    —
                  </span>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <ng-template #noDonations>
        <div class="no-data">
          <i class="fas fa-calendar-times"></i>
          <p>Nenhuma doação agendada para esta data</p>
        </div>
      </ng-template>
    </div>
  </section>

  <!------------------------------------->
  <!---------STATUS-BASED STATS---------->
  <!------------------------------------->
  <section class="app-card card-overflow">
    <div class="app-card-header">
      <i class="fas fa-info-circle app-card-icon"></i>
      <h2 class="app-card-title">Estatísticas por Status</h2>
    </div>

    <app-preloader *ngIf="loadingStats" type="skeleton-cards" [count]="3" [size]="'large'" [visible]="true"></app-preloader>

    <div class="cards-grid-small" style="margin-top: 1rem;" *ngIf="!loadingStats">
        <article class="card stat-card stat-pending">
            <header class="card-header">
                <i class="fa-regular fa-hourglass-half stat-icon icon-pending"></i>
                <div class="stat-info">
                    <h3 class="stat-value">{{ stats.pending }}</h3>
                    <p class="stat-label">Doações Pendentes</p>
                </div>
            </header>
        </article>

        <article class="card stat-card stat-confirmed">
            <header class="card-header">
                <i class="fas fa-check stat-icon stats-confirmed icon-confirmed" ></i>
                <div class="stat-info">
                    <h3 class="stat-value">{{ stats.confirmed }}</h3>
                    <p class="stat-label">Doações confirmadas</p>
                </div>
            </header>
        </article>

        <article class="card stat-card stat-completed">
            <header class="card-header">
                <i class="fas fa-check-double stat-icon icon-completed"></i>
                <div class="stat-info">
                    <h3 class="stat-value">{{ stats.completed }}</h3>
                    <p class="stat-label">Doações completadas</p>
                </div>
            </header>
        </article>

        <article class="card stat-card stat-cancelled">
            <header class="card-header">
                <i class="fas fa-times stat-icon icon-cancelled"></i>
                <div class="stat-info">
                    <h3 class="stat-value">{{ stats.cancelled }}</h3>
                    <p class="stat-label">Doações canceladas</p>
                </div>
            </header>
        </article>
    </div>
  </section>
  
  <!------------------------------------->
  <!------------GENERAL STATS------------>
  <!------------------------------------->
  <section class="app-card card-overflow">
    <div class="app-card-header">
      <i class="fas fa-info-circle app-card-icon"></i>
      <h2 class="app-card-title">Estatísticas Gerais</h2>
    </div>

    <app-preloader *ngIf="loadingStats" type="skeleton-cards" [count]="3" [size]="'large'" [visible]="true"></app-preloader>

    <div class="cards-grid-medium" style="margin-top: 1rem;" *ngIf="!loadingStats">
        <article class="card stat-card stat-scheduled">
            <header class="card-header">
                <i class="fas fa-calendar-check stat-icon"></i>
                <div class="stat-info">
                    <h3 class="stat-value">{{ stats.scheduledDonations }}</h3>
                    <p class="stat-label">Doações Agendadas</p>
                </div>
            </header>
        </article>

        <article class="card stat-card stat-total">
            <header class="card-header">
                <i class="fas fa-hand-holding-heart stat-icon"></i>
                <div class="stat-info">
                    <h3 class="stat-value">{{ stats.totalDonations }}</h3>
                    <p class="stat-label">Total de Doações</p>
                </div>
            </header>
        </article>

        <article class="card stat-card stat-average">
            <header class="card-header">
                <i class="fas fa-chart-bar stat-icon"></i>
                <div class="stat-info">
                    <h3 class="stat-value">{{ stats.monthlyAverage }}</h3>
                    <p class="stat-label">Média de Doações Mensais</p>
                </div>
            </header>
        </article>
    </div>
  </section>
</div>