<div class="dashboard-container">

  <!-- =================== -->
  <!-- BLOODBANK DASHBOARD -->
  <!-- =================== -->
  <bloodbank-dashboard *ngIf="userRole === roles.Bloodbank"></bloodbank-dashboard>

  <!-- ================= -->
  <!-- PARTNER DASHBOARD -->
  <!-- ================= -->
  <partner-dashboard *ngIf="userRole === roles.Partner"></partner-dashboard>

  <!-- =============== -->
  <!-- WELCOME SECTION -->
  <!-- =============== -->
  <section class="app-card card-overflow" *ngIf="userRole === null">
    <div class="welcome-app-card">
        <div class="welcome-app-card-header">
          <i class="fa-solid fa-droplet app-card-icon"></i>
          <h1 class="welcome-title">Bem vindo ao Quatro Vidas!</h1>
        </div>
        <div class="welcome-app-card-body">
          <p>
            Doar sangue não precisa ser complicado. O <strong>Quatro Vidas</strong> 
            conecta você aos bancos de sangue de forma simples e prática, tornando 
            cada doação mais fácil e significativa. Aqui você encontra campanhas, 
            acompanha seu histórico, recebe lembretes e ainda pode ser reconhecido 
            pelo seu impacto!
          </p>
          <h3 class="welcome-impact">Junte-se a nós e transforme vidas com apenas alguns cliques!</h3>
        </div>
    </div>
  </section>

  <!-- ============= -->
  <!-- GUIDE SECTION -->
  <!-- ============= -->
  <section class="app-card" *ngIf="userRole === null">
    <div class="app-card-header">
      <i class="fa-solid fa-circle-question app-card-icon"></i>
      <h1 class="app-card-title">Informações Gerais:</h1>
    </div>
    <article class="card guide donator">
        <header class="card-header donator">
            <div class="guide-info-donator">
                <h3 class="guide-info-title">Para Doadores: </h3>
                <p class="guide-info-description">
                  Responda questionários de aptidão, agende suas doações, encontre 
                  bancos de sangue próximos no mapa e troque pontos por ofertas 
                  exclusivas de parceiros. Doe sangue e seja recompensado!
                </p>                
            </div>
            <i class="fa-solid fa-users icon-donators"></i>
        </header>
    </article>
    <article class="card guide donator">
        <header class="card-header donator">
            <div class="guide-info-donator">
                <h3 class="guide-info-title">Para Bancos de Sangue: </h3>
                <p class="guide-info-description">
                  Promova campanhas de doação, disponibilize datas para agendamento 
                  e acompanhe estatísticas detalhadas. Gerencie doações confirmando, 
                  completando ou cancelando agendamentos de forma prática.
                </p>
            </div>
            <i class="fa-solid fa-hospital"></i>
        </header>
    </article>
    <article class="card guide donator">
        <header class="card-header donator">
            <div class="guide-info-donator">
                <h3 class="guide-info-title">Para Parceiros: </h3>
                <p class="guide-info-description">
                  Engaje doadores oferecendo descontos e brindes exclusivos. 
                  Crie postagens com ofertas especiais e reconheça usuários 
                  ativos através do sistema de pontos da plataforma.
                </p>
            </div>
            <i class="fa-solid fa-handshake-angle"></i>
        </header>
    </article>
  </section>

  <!-- ================== -->
  <!-- USER GUIDE SECTION -->
  <!-- ================== -->
  <section class="app-card card-overflow" *ngIf="showTutorial">
    <div class="guide-app-card">
      <div class="guide-card-header">
        <i class="fa-solid fa-heart app-card-icon-tutorial"></i>
        <div class="donator-tutorial-header">
          <h1 class="guide-title">Como doar sangue</h1>
          <p class="guide-subtitle">Siga estes passos simples e salve vidas!</p>
        </div>
      </div>
      
      <article class="card guide donator">
        <div class="steps-container">
          <div class="step-item">
            <div class="step-number">1</div>
            <div class="step-content">
              <h3 class="step-title">Verifique sua eligibilidade</h3>
              <p class="step-description">Responda um questionário rápido para saber se você pode doar</p>
              <a routerLink="/questionario" class="step-action">Iniciar questionário</a>
            </div>
            <i class="fas fa-clipboard-list step-icon"></i>
          </div>

          <div class="step-divider"></div>

          <div class="step-item">
            <div class="step-number">2</div>
            <div class="step-content">
              <h3 class="step-title">Encontre o banco de sangue</h3>
              <p class="step-description">Localize o posto de coleta mais próximo de você</p>
              <a routerLink="/mapa" class="step-action">Ver no mapa</a>
            </div>
            <i class="fas fa-map-location-dot step-icon"></i>
          </div>

          <div class="step-divider"></div>

          <div class="step-item">
            <div class="step-number">3</div>
            <div class="step-content">
              <h3 class="step-title">Agende sua doação</h3>
              <p class="step-description">Escolha o melhor dia e horário para você</p>
              <a routerLink="/agendamento" class="step-action">Ver disponibilidade</a>
            </div>
            <i class="fas fa-calendar-days step-icon"></i>
          </div>

          <div class="step-divider"></div>

          <div class="step-item">
            <div class="step-number">4</div>
            <div class="step-content">
              <h3 class="step-title">Doe e salve vidas!</h3>
              <p class="step-description">Compareça no dia agendado e faça a diferença</p>
              <div class="step-impact">
                <i class="fa-solid fa-heart-pulse"></i>
                <span>Cada doação pode salvar até 4 vidas!</span>
              </div>
            </div>
            <i class="fa-solid fa-hand-holding-droplet step-icon"></i>
          </div>
        </div>

        <div class="step-divider"></div>
              
        <div class="step-item">
          <div class="step-number">5</div>
          <div class="step-content">
            <h3 class="step-title">Acumule pontos!</h3>
            <p class="step-description">Ganhe recompensas exclusivas a cada doação realizada!</p>
            <a routerLink="/recompensas" class="step-action">Resgatar recompensas</a>
          </div>
          <i class="fa-solid fa-gift step-icon"></i>
        </div>

        <div class="guide-footer">
          <div class="motivational-message">
            <i class="fa-solid fa-star"></i>
            <p>O processo de doação leva cerca de 40 minutos. Você está pronto para ser um herói?</p>
          </div>
          <a routerLink="/questionario" class="cta-button">Começar agora<i class="fa-solid fa-rocket"></i></a>
        </div>
      </article>
    </div>
  </section>

  <!-- ================= -->
  <!-- CAMPAIGNS SECTION -->
  <!-- ================= -->
  <section class="app-card card-overflow" *ngIf="userRole !== roles.Partner">
    <div class="app-card-header">
      <i class="fas fa-book-medical app-card-icon"></i>
      <h2 class="app-card-title">{{ POSTS_SECTION_TITLE }}</h2>
    </div>

    <app-preloader *ngIf="loadingPosts" type="skeleton-cards" [count]="2" [size]="'large'" [visible]="true"></app-preloader>

    <div class="cards-column cards-grid-overflow-large">
      <article class="card post" *ngFor="let post of posts">
        <header class="card-header">
          <h3 class="card-title dashboard-card-title">{{ post.title }}</h3>
          <p class="card-subtitle">
            <time [attr.datetime]="post.startDate">{{ post.startDate | date: 'dd/MM/yyyy' }}</time>
            até
            <time [attr.datetime]="post.endDate">{{ post.endDate | date: 'dd/MM/yyyy' }}</time>
          </p>
        </header>
        <p class="card-body">{{ post.body }}</p>
        <footer class="card-footer">
          <p class="address">{{ post.location.street }} - {{ post.location.city }}-{{ post.location.state }} - {{ post.location.zipCode }}</p>
          <a class="phone-link" [href]="'tel:' + post.phone">{{ post.phone }}</a>
        </footer>
      </article>
    </div>
  </section>

  <!-- ============== -->
  <!-- OFFERS SECTION -->
  <!-- ============== -->
  <section class="app-card">
    <div class="app-card-header">
      <i class="fas fa-tags app-card-icon"></i>
      <h2 class="app-card-title">{{ OFFERS_SECTION_TITLE }}</h2>
    </div>

    <app-preloader *ngIf="loadingOffers" type="skeleton-cards" [count]="3" [size]="'medium'" [visible]="true"></app-preloader>

    <div class="cards-grid-medium cards-grid-overflow-medium">
      <article class="card offer" *ngFor="let offer of offers">
        <header class="card-header">
          <h3 class="card-title">
            <span class="offer-partner-name">{{ offer.partnerName }}</span>: {{ offer.title }}
          </h3>
        </header>
        <p class="card-body">{{ offer.body }}</p>
        <footer class="card-footer">
          <p class="offer-discount">{{ offer.discountPercentage }}% de desconto</p>
          <time class="offer-valid-until">Válido até: {{ offer.validUntil | date: 'dd/MM/yyyy' }}</time>
        </footer>
      </article>
    </div>
  </section>

  <!-- ========================= -->
  <!-- NEARBY BLOODBANKS SECTION -->
  <!-- ========================= -->
  <section class="app-card">
    <div class="app-card-header">
      <i class="fas fa-location-dot app-card-icon"></i>
      <h2 class="app-card-title">{{ NEARBY_BLOODBANKS_SECTION_TITLE }}</h2>
    </div>
    <!-- VISIBLE ONLY TO LOGGED-IN USERS WITH ROLE 'USER' -->
    <ng-container *ngIf="isLoggedIn; else loginPrompt">
      <ng-container *ngIf="userRole === roles.User; else restrictedRolePrompt">

        <app-preloader *ngIf="loadingBloodbanks" type="skeleton-cards" [count]="3" [size]="'medium'" [visible]="true"></app-preloader>

        <div class="cards-grid-medium cards-grid-overflow-medium">
          <article class="card bloodbank" *ngFor="let bloodbank of nearbyBloodbanks">
            <header class="card-header">
              <h3 class="card-title">{{ bloodbank.name }}</h3>
              <p class="card-title">{{ getReadableBloodbankDistance(bloodbank.distance) }} de distância</p>
              <p class="address">{{ bloodbank.address.street }} - {{ bloodbank.address.city }}-{{ bloodbank.address.state }} - {{ bloodbank.address.zipCode }}</p>
            </header>
            <footer class="card-footer">
              <a class="phone-link" [href]="'tel:' + bloodbank.phone">{{ bloodbank.phone }}</a>
            </footer>
          </article>
          <p *ngIf="!loadingBloodbanks && nearbyBloodbanks.length === 0">Não foi possível encontrar bancos de sangue próximos a você :(</p>
        </div>
      </ng-container>
    </ng-container>
  </section>

  <!-- ================== -->
  <!-- STATISTICS SECTION -->
  <!-- ================== -->
  <section class="app-card">
    <div class="app-card-header">
      <i class="fas fa-chart-simple app-card-icon"></i>
      <h2 class="app-card-title">{{ STATS_SECTION_TITLE }}</h2>
    </div>
    <!-- VISIBLE ONLY TO LOGGED-IN USERS WITH ROLE 'USER' -->
    <ng-container *ngIf="isLoggedIn; else loginPrompt">
      <ng-container *ngIf="userRole === roles.User; else restrictedRolePrompt">

        <app-preloader *ngIf="loadingStatsAndAchievements" type="skeleton-cards" [count]="6" [size]="'small'" [visible]="true"></app-preloader>

        <div class="cards-grid-small" *ngIf="!loadingStatsAndAchievements">
          <div class="stat-card" *ngFor="let stat of [
            { icon: 'fa-hand-holding-heart', label: 'Doações', value: userStats.timesDonated },
            { icon: 'fa-heartbeat', label: 'Vidas salvas', value: userStats.potentialLivesSaved },
            { icon: 'fa-heart', label: 'Você doou', value: totalLitersDonated},
            { icon: 'custom', label: 'Total de pontos', value: userStats.totalPoints },
            { icon: 'fa-tint', label: 'Tipo sanguíneo', value: userStats.bloodType },
            { icon: 'fa-calendar-check', label: 'Última doação', value: userStats.lastDonationDate ? (userStats.lastDonationDate | date: 'dd/MM/yyyy') : 'Ainda não doou' },
            { icon: 'fa-clock', label: 'Data para doar de novo', value: userStats.nextDonationDate ? (userStats.nextDonationDate | date: 'dd/MM/yyyy') : 'Pré-agende agora!' },
            { icon: 'fa-calendar-day', label: 'Dias até poder doar', value: userStats.daysUntilNextDonation || 'Já pode doar!' },
          ]">
            <ng-container *ngIf="stat.icon !== 'custom'; else customIcon">
              <i class="fas {{ stat.icon }} stat-icon"></i>
            </ng-container>
            <ng-template #customIcon>
              <img src="assets/icon.png" style="height: 29px; width: 31px;">
            </ng-template>
            <p class="stat-label">{{ stat.label }}</p>
            <p class="stat-value">{{ stat.value }}</p>
          </div>
        </div>
      </ng-container>
    </ng-container>
  </section>

  <!-- ==================== -->
  <!-- ACHIEVEMENTS SECTION -->
  <!-- ==================== -->
  <section class="app-card">
    <div class="app-card-header">
      <i class="fas fa-trophy app-card-icon"></i>
      <h2 class="app-card-title">{{ ACHIEVEMENTS_SECTION_TITLE }}</h2>
    </div>
    <!-- VISIBLE ONLY TO LOGGED-IN USERS WITH ROLE 'USER' -->
    <ng-container *ngIf="isLoggedIn; else loginPrompt">
      <ng-container *ngIf="userRole === roles.User; else restrictedRolePrompt">

        <app-preloader *ngIf="loadingStatsAndAchievements" type="spinner" [visible]="true"></app-preloader>

        <div class="achievements-grid" *ngIf="!loadingStatsAndAchievements">
          <div
            *ngFor="let achievement of userStats.achievements"
            class="achievement-square-card tooltip-container"
            [ngClass]="achievement.rarity.toLowerCase()"
          >
            <i class="fas achievement-icon" [ngClass]="achievement.imageUrl"></i>
            <div class="achievement-info">
              <span class="achievement-title">{{ achievement.title }}</span>
              <span class="achievement-points">+{{ achievement.points }} pts</span>
            </div>
            <div class="tooltip">{{ achievement.description }}</div>
          </div>
        </div>
      </ng-container>
    </ng-container>
  </section>

  <!-- ==================== -->
  <!-- LEADERBOARDS SECTION -->
  <!-- ==================== -->
  <leaderboards></leaderboards>

  <!-- ======================= -->
  <!-- LOGIN REQUIRED TEMPLATE -->
  <!-- ======================= -->
  <ng-template #loginPrompt>
    <div class="card">
      <p class="card-title">{{ LOGIN_REQUIRED_MESSAGE }}</p>
      <button [routerLink]="'/' + appRoutesPaths.LOGIN" class="app-button">Fazer Login</button>
    </div>
  </ng-template>

  <!-- ======================== -->
  <!-- RESTRICTED ROLE TEMPLATE -->
  <!-- ======================== -->
  <ng-template #restrictedRolePrompt>
    <div class="card">
      <p class="card-title">
        Esta seção é exclusiva para doadores.
      </p>
    </div>
  </ng-template>

</div>