<!-- Loading e mensagens -->
<div *ngIf="isLoading" class="loading-spinner">
  <i class="fa-solid fa-spinner fa-spin"></i>
  Carregando...
</div>

<div *ngIf="error" class="error-message">
  <i class="fa-solid fa-exclamation-triangle"></i>
  {{ error }}
</div>

<div *ngIf="successMessage" class="success-message">
  <i class="fa-solid fa-check-circle"></i>
  {{ successMessage }}
</div>
<!-- Modo Visualização -->
<div *ngIf="!editProfileMode">
  
  <div class="app-card">
    <div class="app-card-header">
      <i class="fa-solid fa-hospital app-card-icon"></i>
      <h2 class="app-card-title">Perfil do Banco de Sangue</h2>
    </div>

    <div class="account-header">
      <div class="profile-photo-wrapper">
        <img [src]="bloodBank?.photoUrl || 'assets/bloodbank.png'"
             alt="Foto do Banco"
             class="profile-photo" />
        <input #fileInput 
               type="file"
               (change)="onPhotoSelected($event)"
               accept="image/*"
               hidden>
        <button type="button"
                class="profile-photo-edit-btn"
                (click)="fileInput.click()"
                [disabled]="isLoading">
          <i class="fa-solid fa-camera"></i>
          Trocar Foto
        </button>
      </div>

      <div class="account-info">
        <p><strong>Nome:</strong> {{ bloodBank?.name }}</p>
        <p><strong>Email:</strong> {{ bloodBank?.email }}</p>
        <p><strong>Endereço:</strong> {{ bloodBank?.address?.street }} - {{ bloodBank?.address?.city }}-{{ bloodBank?.address?.state }}</p>
        <p><strong>Telefone:</strong> {{ getFormattedPhone(bloodBank?.phone) }}</p>
        <p><strong>CNPJ:</strong> {{ getFormattedCNPJ(bloodBank?.cnpj) }}</p>
        <p *ngIf="bloodBank?.description"><strong>Descrição:</strong> {{ bloodBank?.description }}</p>
        <p *ngIf="bloodBank?.website"><strong>Website:</strong> {{ bloodBank?.website }}</p>
        <button type="button"
                (click)="onEditProfile()"
                [disabled]="isLoading || addCampaignMode || editCampaignMode">
          <i class="fa-solid fa-edit"></i>
          Editar Perfil
        </button>
      </div>
    </div>
  </div>

</div>
<!-- Formulário de Edição do Perfil -->
<div *ngIf="editProfileMode" class="app-card">
  <div class="app-card-header">
    <i class="fa-solid fa-user-edit app-card-icon"></i>
    <h2 class="app-card-title">Editar Perfil</h2>
  </div>

  <form [formGroup]="profileForm" (ngSubmit)="saveProfile()">
    
    <label>
      <span>Nome do Banco</span>
      <input type="text" formControlName="name" placeholder="Nome completo" [class.invalid]="isFieldInvalid(profileForm, 'name')" />
    </label>

    <label>
      <span>Email</span>
      <input type="email" formControlName="email" [class.invalid]="isFieldInvalid(profileForm, 'email')" />
      </label>
        <label>
            <span>UF</span>
            <input type="text" 
                   formControlName="state" 
                   placeholder="SP"
                   maxlength="2"
                   style="text-align: center; text-transform: uppercase;"
                   [class.invalid]="isFieldInvalid(profileForm, 'state')" />
        </label>

    <label>
        <span>Cidade</span>
        <input type="text" formControlName="city" placeholder="Cidade" [class.invalid]="isFieldInvalid(profileForm, 'city')" />
    </label>

    <label>
        <span>Rua / Número</span>
        <input type="text" formControlName="street" placeholder="Rua, Número, Bairro" [class.invalid]="isFieldInvalid(profileForm, 'street')" />
    </label>

    <label>
      <span>Telefone</span>
      <input type="tel" 
             formControlName="phone" 
             placeholder="(00) 00000-0000"
             (input)="formatPhone($event)"
             maxlength="16"
             [class.invalid]="isFieldInvalid(profileForm, 'phone')" />
    </label>

    <label>
      <span>CNPJ</span>
      <input type="text" 
             formControlName="cnpj" 
             placeholder="00.000.000/0000-00"
             (input)="formatCNPJ($event)"
             maxlength="18"
             [class.invalid]="isFieldInvalid(profileForm, 'cnpj')" />
    </label>

    <div class="form-actions">
      <button type="submit" class="primary" [disabled]="isLoading || profileForm.invalid">
        <i class="fa-solid fa-save"></i> Salvar Alterações
      </button>
      <button type="button" class="secondary" (click)="cancelEdit()" [disabled]="isLoading">
        <i class="fa-solid fa-times"></i> Cancelar
      </button>
    </div>
  </form>
</div>